# AGENTS.md — Контекст для AI-ассистентов

Этот файл содержит важную информацию о проекте, архитектурных решениях, правилах кодирования и уроках, извлеченных в
процессе разработки. Используйте этот контекст перед началом работы над задачами.

## 1. Обзор проекта
**Student Assistant** — Android-приложение для студентов и школьников (расписание, домашние задания).
* **Стек:** Kotlin, Jetpack Compose, Room, Dagger 2, Coroutines & Flow.
* **Сборка:** Gradle Kotlin DSL, Version Catalogs (`libs.versions.toml`).
* **Архитектура:** Многомодульная (`app`, `features/*`, `core/*`, `common/*`).

## 2. Терминология
* **Lesson**: В коде и комментариях переводить как **"Занятие"**, а не "Урок". Это подразумевает как урок в школе, так и
  пару в университете.
* **Semester**: Семестр или четверть.
* **Homework**: Домашнее задание.

## 3. Архитектура и База Данных
* **Room**: Используется как основной источник истины.
* **LessonRepository**:
    * **Важно:** Логика фильтрации занятий (по дням недели, по датам, чередование недель) реализована **на уровне SQL**
      в `LessonDao`. Не пытайтесь перенести её обратно в Kotlin-код (`filter` в памяти), так как это вызывает проблемы с
      производительностью на больших объемах данных.
    * Используется сложный `UNION` запрос для объединения повторяющихся занятий и занятий по конкретным датам.
* **Навигация**: Используется кастомная обертка над `androidx.navigation3` (`NavigationState`, `Navigator`).

## 4. Правила написания кода
* **Видимость (Visibility):** Всегда используйте модификатор `internal` или `private` для классов, интерфейсов и
  методов, которые не являются частью публичного API модуля. Область видимости должна быть минимально возможной.
* **Документация:** При выяснении новых подробностей о написании кода нужно также обновлять AGENTS.md и README.md.
  На неочевидные моменты нужно добавлять комментарии в код. Вся документация должна быть на русском языке, старую
  документацию на английском языке при изменении файла нужно переводить на русский.

## 5. Тестирование
* Стремимся к 100% покрытию всего кода.
* В тестах нельзя использовать LocalDate.now() и другие функции, результат которых зависит от внешних факторов.
* При проверке работы кода с датой/временем нужно так же проверять корректность работы с високосными годами, переходы с
  одного периода в другой (например, если промежуток времени захватывает полночь или новый год).

### Unit-тесты vs Android-тесты
* Приоритет отдается **Unit-тестам** (папка `test`).
* **Android-тесты** (папка `androidTest`) используются только для проверки корректности сложных SQL-запросов в Room (
  например, логика битовых масок недель в `LessonDao`).

### Использование Fakes
Для Unit-тестов используем самописные Fake-реализации DAO (`FakeLessonDao`, `FakeSemesterDao` и т.д.), находящиеся в
`features/repository/src/test/.../Fakes.kt`.

**Правила для Fakes:**
1. **Сортировка:** Fake DAO должны возвращать данные в том же порядке, что и Room (`ORDER BY`). Если в Room есть
   сортировка, во Fake нужно использовать `.sortedWith(comparator)`.
3. **Изоляция:** Если репозиторий хранит состояние в памяти (например, `SelectedSemesterRepository` кэширует выбранный
   семестр), в тестах необходимо пересоздавать экземпляр репозитория для каждого сценария, чтобы эмулировать "чистый
   старт" и избежать влияния тестов друг на друга.
